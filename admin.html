<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Jeu de Piste</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="admin-style.css">
</head>
<body>
    <div id="admin-app">
        <!-- Modal d'authentification admin -->
        <div id="admin-auth-modal" class="modal">
            <div class="modal-content">
                <h2>🔐 Accès Administrateur</h2>
                <p>Connectez-vous avec votre compte Firebase :</p>
                <input type="email" id="admin-email" placeholder="Email administrateur" required>
                <input type="password" id="admin-password" placeholder="Mot de passe" required>
                <button id="admin-login-btn">Se connecter</button>
                <div id="auth-error" class="error-message" style="display: none;"></div>
                <div id="auth-loading" style="display: none;">
                    <p>🔄 Connexion en cours...</p>
                </div>
            </div>
        </div>

        <!-- Interface admin principale -->
        <div id="admin-interface" style="display: none;">
            <header>
                <h1>🎯 Administration - Jeu de Piste</h1>
                <div class="admin-info">
                    <span id="session-info">Session active</span>
                    <button id="logout-btn">Déconnexion</button>
                </div>
            </header>

            <main>
                <!-- Statistiques générales -->
                <section class="stats-section">
                    <h2>📊 Vue d'ensemble</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Équipes actives</h3>
                            <span id="active-teams-count">0</span>
                        </div>
                        <div class="stat-card">
                            <h3>Validations en attente</h3>
                            <span id="pending-validations-count">0</span>
                        </div>
                        <div class="stat-card">
                            <h3>Équipes terminées</h3>
                            <span id="completed-teams-count">0</span>
                        </div>
                    </div>
                </section>

                <!-- Validations en attente -->
                <section class="validations-section">
                    <h2>⏳ Validations en attente</h2>
                    <div id="pending-validations">
                        <p class="no-data">Aucune validation en attente</p>
                    </div>
                </section>

                <!-- Équipes et progression -->
                <section class="teams-section">
                    <h2>👥 Équipes et Progression</h2>
                    <div id="teams-list">
                        <p class="no-data">Aucune équipe active</p>
                    </div>
                </section>

                <!-- Gestion des équipes -->
                <section class="teams-management">
                    <h2>🏆 Gestion des Équipes</h2>
                    <div class="management-header">
                        <button id="create-team-btn" class="success-btn">➕ Créer une équipe</button>
                    </div>
                    <div id="teams-management-list">
                        <p class="no-data">Aucune équipe créée</p>
                    </div>
                </section>

                <!-- Gestion des utilisateurs -->
                <section class="users-management">
                    <h2>👤 Gestion des Utilisateurs</h2>
                    <div class="management-header">
                        <button id="create-user-btn" class="success-btn">➕ Créer un utilisateur</button>
                    </div>
                    <div id="users-management-list">
                        <p class="no-data">Aucun utilisateur créé</p>
                    </div>
                </section>

                <!-- Actions rapides -->
                <section class="quick-actions">
                    <h2>⚡ Actions rapides</h2>
                    <div class="actions-grid">
                        <button id="reset-all-teams" class="danger-btn">🔄 Reset toutes les équipes</button>
                        <button id="reset-all-progressions" class="warning-btn">🏠 Reset progressions → Lobby</button>
                        <button id="export-data" class="info-btn">📊 Exporter les données</button>
                        <button id="refresh-data" class="success-btn">🔄 Actualiser</button>
                    </div>
                </section>
            </main>
        </div>

        <!-- Notifications -->
        <div id="admin-notifications"></div>

        <!-- Modal création équipe -->
        <div id="create-team-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>🏆 Créer une Équipe</h2>
                <form id="create-team-form">
                    <input type="text" id="team-name" placeholder="Nom de l'équipe" required>
                    <input type="color" id="team-color" value="#e74c3c" title="Couleur de l'équipe">
                    <select id="team-route" required>
                        <option value="">-- Parcours --</option>
                        <option value="0,1,2">Standard (Lobby → Point 1 → Point 2)</option>
                        <option value="0,2,1">Inversé (Lobby → Point 2 → Point 1)</option>
                    </select>
                    <div class="modal-actions">
                        <button type="button" id="cancel-team-btn" class="cancel-btn">Annuler</button>
                        <button type="submit" class="success-btn">Créer l'équipe</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal création utilisateur -->
        <div id="create-user-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>👤 Créer un Utilisateur</h2>
                <form id="create-user-form">
                    <input type="text" id="user-name" placeholder="Nom du joueur" required>
                    <input type="text" id="user-id-input" placeholder="Identifiant (ex: joueur1)" required>
                    <input type="password" id="user-password-input" placeholder="Mot de passe" required>
                    <select id="user-team" required>
                        <option value="">-- Choisir une équipe --</option>
                    </select>
                    <div class="modal-actions">
                        <button type="button" id="cancel-user-btn" class="cancel-btn">Annuler</button>
                        <button type="submit" class="success-btn">Créer l'utilisateur</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { firebaseConfig } from './firebase-config.js';
        import FirebaseService from './firebase-service.js';
        
        // Initialiser Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const firebaseService = new FirebaseService(db);
        
        // Exposer globalement
        window.firebaseApp = app;
        window.firebaseDb = db;
        window.firebaseAuth = auth;
        window.firebaseService = firebaseService;
        
        // Initialiser l'admin une fois Firebase prêt
        window.addEventListener('DOMContentLoaded', () => {
            if (window.initializeAdmin) {
                window.initializeAdmin();
            }
        });
    </script>
    
    <script src="admin-script.js"></script>
</body>
</html>
